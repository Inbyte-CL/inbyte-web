---
// components
import NavLink from "@/components/nav/NavLink.astro";
import NavDropdownToggle from "@/components/nav/NavDropdown/NavDropdownToggle.astro";
import MegaMenuDropdownToggle from "./NavDropdown/MegaMenuDropdownToggle.astro";
import MobileNav from "@/components/nav/MobileNav/MobileNav.astro";
import SiteLogo from "@/components/site-logo/SiteLogo.astro";
import Button from "@/components/button/Button.astro";

// utils
import { getLocaleFromUrl } from "@/js/localeUtils";
import { getTranslatedData } from "@/js/translationUtils";

// data
const currLocale = getLocaleFromUrl(Astro.url);
const navData = getTranslatedData("navData", currLocale);
// console.log(JSON.stringify(navData, null, 2));
---

<section
	id="nav"
	class:list={[
		"navbar--initial relative -top-px z-30 flex h-20 w-full flex-col border-b transition-all duration-300 md:mt-3",
		"data-[scrolled=false]:border-b-transparent data-[scrolled=false]:bg-transparent",
		"data-[scrolled=true]:border-foreground/10 data-[scrolled=true]:bg-background data-[scrolled=true]:sticky",
		"data-[scrolled=true]:animate-in data-[scrolled=true]:slide-in-from-top-10 data-[scrolled=true]:duration-500",
	]}
	data-scrolled={false}
>
	<div class="flex h-full w-full">
		<div class="site-container flex w-full items-center">
			<header class="relative flex w-full items-center gap-2">
				<!-- Left spacer -->
				<div class="flex h-full flex-auto justify-start"></div>

				<!-- Logo centered -->
				<div class="absolute left-[44%] -translate-x-1/2">
					<SiteLogo />
				</div>

				<!-- desktop nav menu -->
				<div class="flex h-full flex-auto justify-end">
					<div class="flex h-full items-center gap-4">
						<nav class="hidden md:block">
							<ul class="flex h-full items-center">
								{
									// if dropdown exists, setup the dropdown, otherwise it is just a link
									navData.map((navItem) =>
										"dropdown" in navItem ? (
											// non-mobile dropdown menu
											<NavDropdownToggle navItem={navItem} />
										) : "megaMenuColumns" in navItem ? (
											<MegaMenuDropdownToggle {navItem} />
										) : (
											// normal nav link
											<NavLink {navItem} />
										),
									)
								}
							</ul>
						</nav>

						<!-- mobile nav menu, only load on small screens where it is visible -->
						<div class="flex items-center md:hidden">
							<MobileNav />
						</div>
					</div>
				</div>
			</header>
		</div>
	</div>
</section>

{/*script on scrolldown to make navbar more legible*/}
<script>
	let navbar: HTMLElement | null;

	function scrollHandler() {
		if (navbar) {
			if (window.scrollY > 350) {
				navbar.setAttribute("data-scrolled", "true");
			} else {
				navbar.setAttribute("data-scrolled", "false");
			}
		}
	}

	function initNav() {
		navbar = document.getElementById("nav");
		window.addEventListener("scroll", scrollHandler, { passive: true });
	}

	// runs on initial page load
	initNav();

	// runs on view transitions navigation. Not needed if item has "transition:persist"
	document.addEventListener("astro:after-swap", initNav);
</script>
